<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <?include $(sys.CURRENTDIR)\Variables.wxi ?>

  <Product Id="*"
           Name="$(var.ProductName)"
           Language="2052"
           Version="$(var.ProductVersion)"
           Manufacturer="Ubo China"
           UpgradeCode="$(var.UpgradeCode)">

    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine"/>

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." AllowSameVersionUpgrades="yes" />

    <Media Id="1" CompressionLevel="high" EmbedCab="yes" Cabinet="Cabinet.cab" />

    <!-- .Net Framework check and other custom actions -->
    <PropertyRef Id="NETFRAMEWORK40FULL" />
    <Condition Message="This application requires .NET Framework 4.0. Please install the .NET Framework then run this installer again.">
      <![CDATA[Installed OR NETFRAMEWORK40FULL]]>
    </Condition>

    <!-- .NET framework root paths -->
    <PropertyRef Id="NETFRAMEWORK40FULLINSTALLROOTDIR" />

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="UboConfigTool">
        </Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="UboConfigTool"/>
      </Directory>
      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <Icon Id="ApplicationIcon" SourceFile="content/Application.ico"/>

    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="3CA320A4-772E-4301-BA25-0083C088195F">
        <Shortcut Id="ApplicationStartMenuShortcut" Name="UboConfigTool" Description="UboConfigTool"
                  Target="[INSTALLFOLDER]UboConfigTool.exe" Icon="ApplicationIcon"
                  WorkingDirectory="INSTALLFOLDER">
        </Shortcut>
        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\Microsoft\UboConfigTool" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="DesktopFolder">
      <Component Id="DesktopFolderShortcut" Guid="515F578C-5B52-4A21-904B-6E0CF03534FA">
        <Shortcut Id="DesktopShortcut" Directory="DesktopFolder"   Name="UboConfigTool" Target="[INSTALLFOLDER]UboConfigTool.exe"  WorkingDirectory="INSTALLFOLDER" Icon="ApplicationIcon"></Shortcut>
        <RemoveFolder Id="DesktopFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\Microsoft\UboConfigTool" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <Feature Id="ProductFeature" Title="$(var.ProductName)" Level="1">
      <ComponentGroupRef Id="UBOConfigToolComponentGrp" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="DesktopFolderShortcut"/>
    </Feature>

    <!-- Default WiX UI -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <UIRef Id="WixUI_CustomDialog" />

  </Product>
</Wix>